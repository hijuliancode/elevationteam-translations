#!/usr/bin/env node
"use strict";var t=require("fs"),e=require("path"),n=require("readline"),s=require("openai"),o=require("dotenv");const a=n.createInterface({input:process.stdin,output:process.stdout});function r(t){return new Promise((e=>a.question(t,e)))}o.config();const i=process.env.OPENAI_API_KEY,c=process.env.OPENAI_ORGANIZATION;i||(console.error("Error: OPENAI_API_KEY is required to use the OpenAI API"),process.exit(1));const l=new class{opeanai;constructor(t,e){this.opeanai=new s.OpenAI({apiKey:t,organization:e})}async translate(t,e){try{const n=await this.opeanai.chat.completions.create({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a helpful assistant that translates text."},{role:"user",content:`Translate the following text to ${e}: "${t}"`}]});return n.choices[0]?.message?.content?.trim()||""}catch(t){return console.error("Error translating text",t),""}}}(i,c);const[,,u]=process.argv;if("init"===u)!async function(){console.log("Welcome to the Elevation Team Translation CLI!");let n=await r("Enter the base locale (e.g., en) [default: en]: ")||"en",s=await r("Enter the input directory for translation files (e.g., src/translations) [default: src/translations]: ")||"src/translations",o=await r("Enter the output directory for generated translation files (e.g., src/translations) [default: src/translations]: ")||"src/translations",a=await r("Enter the output format (e.g., json, js) [default: json]: ")||"json";const i=(await r("Enter target locales separated by space or comma (e.g., fr, es, de): ")).split(/[\s,]+/).filter((t=>t)),c=e.join(process.cwd(),"translation.config.ts");if(t.existsSync(c))return void console.log("Config file already exists at translation.config.ts");const l=await r("¿Qué proveedor de IA desea usar para las traducciones? (openai): "),u=`\nexport const translationConfig = {\n  baseLocale: '${n}', // Base language for translations\n  languages: ['${n}', ${i.map((t=>`'${t}'`)).join(", ")}], // Target languages for translations\n  inputDir: '${s}', // Directory for the base translation files\n  outputDir: '${o}', // Directory for the generated translation files\n  format: '${a}', // Output format (e.g., json, js)\n  aiProvider: '${l}', // AI provider for translations\n};\n\n`;t.writeFileSync(c,u),console.log("Config file created successfully at translation.config.ts");const p=e.join(process.cwd(),"package.json");if(!t.existsSync(p))return void console.error("Error: package.json not found. Please ensure you are in a Node.js project.");const f=JSON.parse(t.readFileSync(p,"utf-8"));f.scripts=f.scripts||{},f.scripts["translation:watch"]?console.log('Script "translation:watch" already exists in package.json'):(f.scripts["translation:watch"]="@elevationteam/translations watch",console.log('Script "translation:watch" added to package.json')),f.scripts["translation:run"]?console.log('Script "translation:run" already exists in package.json'):(f.scripts["translation:run"]="@elevationteam/translations run",console.log('Script "translation:run" added to package.json')),t.writeFileSync(p,JSON.stringify(f,null,2))}();else if("watch"===u){!async function(n){const{baseLocale:s,locales:o,inputDir:a,outputDir:r,format:i}=n,c=e.join(process.cwd(),a,`${s}.${i}`);t.existsSync(c)?(t.watch(c,(async n=>{if("change"===n){console.log(`Changes detected in ${c}`);try{const n=JSON.parse(t.readFileSync(c,"utf-8"));for(const a of o){if(a===s)continue;const o=e.join(process.cwd(),r,`${a}.${i}`);let c={};t.existsSync(o)&&(c=JSON.parse(t.readFileSync(o,"utf-8")));const u={...c};for(const[t,e]of Object.entries(n))c[t]&&c[t]===e||(u[t]=await l.translate(e,a));t.writeFileSync(o,JSON.stringify(u,null,2)),console.log(`Translation updated for ${a} at ${o}`)}}catch(t){console.error(`Error processing translations: ${t.message}`)}}})),console.log(`Watching for changes in ${c}`)):console.error(`Base file not found: ${c}`)}(require(process.cwd()+"/translations.config.js").translationConfig)}else console.log('Unknown command. Use "init" or "watch".');
